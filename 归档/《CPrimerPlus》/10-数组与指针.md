---
title: 10.数组与指针
date: 2021-08-02 08:05:00
tags: C
---

# 数组与指针

## 数组

- 初始化数组

    - 以逗号分隔的值列表
    -  当初始化列表的值少于数组元素个数时，编译器会把剩余的元素都初始化为0
    - 多于的话报错，初始化没有值的话自动初始化为垃圾值
    - 省略方括号中的数字，编译器自动匹配

- 指定初始化器（C99）

    - P281

- 给数组元素赋值

    借助数组下标（或索引）给数组元素赋值

- 数组边界

    - 编译器不会检查数组下标是否使用得当，使用越界下标的结果是未定义的

- 指定数组的大小

    - C99之前只能在方括号中使用整型常量表达式
    - sizeof表达式被视为整型常量
    - const不是

## 多维数组

- 初始化二维数组
    - 花括号嵌套花括号，内层花括号代表一维数组子元素且遵循相应初始化规则
    - 可以省略内部花括号，后面没有初始化的元素被统一初始化为0

## 指针和数组

- **数组名是数组首元素的地址**
- ar[i] == *(ar+i);,指针表示法和数组表示法是两种等效的方法
- **可以使用指针表示数组名，也可以使用数组名表示指针**

## 函数、数组和指针

- 只有在函数原型或函数定义头中，才可以用int ar[]代替int * ar；
- P291声明数组形参
- 使用指针形参
    - 指针形参+整数（头加大小）
    - 指针形参+指针形参（头加尾）

## 指针操作

- 基本操作
    - 赋值
    - 解引用
    - 取址
    - 指针加整数
    - 指针减整数
    - 指针减指针
    - 比较
    - 递增
    - 递减
- C只能保证指向数组任意元素的指针和指向数组后面第一个位置的指针有效

## 保护数组中的数据

### 对形式参数使用const

- 如果编写的函数需要修改数组，在声明数组形参时则不使用const
- 如果编写的函数不用修改数组，在声明数组形参时最好使用const

### const相关

- const数组

- const指针

- 指向const的指针

    - 把const数据或非const数据的地址初始化为指向const的指针或为其赋值是合法的
    - 只能把非const数据的地址赋给普通指针，使用非const标识符修改const数据导致的结果是未定义的

- 指向const的const指针

    ```C
    const int days[MONTHS] = {...};
    int * const cptr;
    const int * iptr;
    const int * const icptr;
    ```

## 指针和多维数组

- 指向多维数组的指针

    ```C
    int (*ptr)[2] ;//数组指针，正确
    int *ptr[2];//指针数组
    ptr[m][n] == (*ptr+m)[n] == *(*(ptr+m)+n)
    ```

    - []优先级高于*

- 指针的兼容性

    **指针之间的赋值比数值类型之间的赋值要严格，两个不同类型的指针不能相互赋值**

    P306 C和C++中const的区别

- 函数和多维指针

    - 在函数原型中声明一个指向N维数组的指针形式参数时，只能省略最左边方括号中的值

    - 也可以在第一对方括号中写上大小，但是编译器会忽略该值
    - 指针表达式和数组表达式是相同的

## 变长数组

P309

## 复合字面量

- **字面量**是除了符号常量之外的常量

- 创建的同时使用

    ```C
    int * ptr;
    ptr = (int [2]){10.20};
    
    int (*ptr2)[3];
    ptr2 = (int [2][3]){{1,2,3},{4,5,6}};
    ```

    