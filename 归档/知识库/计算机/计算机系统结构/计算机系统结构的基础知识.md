 # 计算机系统结构的基本概念
 
 ## 计算机系统的层次结构
 ![[Pasted image 20220505162723.png]]
 - 计算机系统=硬件/固件+软件
 - 计算机语言从低级向高级发展
 - 从计算机语言的角度，把计算机系统按功能划分成多级层次结构
	 - 每一层以一种语言为特征
 虚拟机：由软件实现的机器
 语言实现的两种基本技术：
 1. **翻译**：先把N+1级程序全部转换成N级程序后，再去执行新产生的N及程序，在执行过程中N+1级程序不再被访问；
 2. **解释**：每当一条N+1级指令被译码后，就直接去执行一串等效的N级指令，然后再去取下一条N+1级的指令，以此重复进行。
 - 解释执行比编译后再执行所花的时间多，但占用的存储空间较少。

## 计算机系统结构的定义
- **计算机系统结构的经典定义**：程序员所看到的计算机属性，即概念性结构与功能特性。
- 按照计算机系统的多级层次结构，不同级程序员所看到的计算机具有不同的属性。
- **透明性**:在计算机技术中，把这种本来存在的事物或属性，但从某种角度又好像不存在的概念称为透明性。
- Amdahl提出的系统结构：传统机器语言级程序员所看到的计算机属性；
- 广义的系统结构定义：指令集结构、组成、硬件
- 对于通用寄存器型机器来说，这些属性主要是指：
	- 指令系统
	- 数据表示
	- 寻址规则
	- 寄存器定义
	- 中断系统
	- 机器工作状态的定义和切换
	- 存储结构
	- 信息的保护
	- IO结构
- **计算机系统结构概念的实质**：确定计算机系统中软、硬件的界面，界面之上是软件实现的功能，界面之下是硬件和固件的功能。

## 计算机组成和计算机实现
1. 计算机系统结构：计算机系统的软件、硬件的界面
2. 计算机组成：计算机结构的逻辑实现（逻辑部件级）
3. 计算机实现：计算机组成的物理实现（物理部件级）
	- 一种体系结构可以有多种组成
	- 一种组成可以有多种物理实现
4. 系列机：由同一厂家生产的具有相同系统结构、但具有不同组成或实现的一系列不同型号的计算机。
5. 兼容机：不同厂家生产的具有相同系统结构、但具有不同组成或实现的一系列不同型号的计算机。

## 计算机系统结构的分类
常见的计算机系统结构分类法有两种：
- Flynn分类法、冯氏分类法
### 冯氏分类法
- 用系统的最大并行度对计算机进行分类
- ![[Pasted image 20220505165241.png]]
### Flynn分类法
- 按照指令流和数据流的多倍性进行分类
- 指令流：计算机执行的指令序列
- 数据流：由指令流调用的数据序列
- 多倍性：在系统受限的部件上，同时处于同一执行阶段的指令或数据的最大数目。
- 分为4类
	- 单指令流单数据流
	![[Pasted image 20220505165657.png]]
	- 单指令流多数据流
![[Pasted image 20220505165731.png]]
- 多指令流单数据流（实际无此机器）
![[Pasted image 20220505165754.png]]
- 多指令流多数据流（多重SISD）
![[Pasted image 20220505165826.png]]

# 定量分析技术
## 定量原理
4个定量原理：
1. 以经常性事件为重点
	1. 对经常发生的情况采用优化方法的原则进行选择，以得到更多的总体上的改进
	2. **优化**：为经常性事件分配更多资源
2. Amdahl定律：
	- 加快某部件执行速度所能获得的系统性能加速比，受限于该部件的执行时间占系统中总执行时间的百分比
	- ![[Pasted image 20220505170659.png]]
	- 加速比依赖于两个因素
		- 可改进比例：在改进前的系统中，可改进部分的执行时间在总的执行时间中所占的比例。
		- 部件加速比：部件改进前所需的执行时间与改进后执行时间的比。
	- 改进后程序的总执行时间
	![[Pasted image 20220505170931.png]]
	- 加速比
![[Pasted image 20220505171031.png]]
	- Amdahl定律：一种性能改进的递减规则。
![[Pasted image 20220505171226.png]]
3. CPU性能公式
![[Pasted image 20220505171503.png]]
![[Pasted image 20220505171646.png]]
![[Pasted image 20220505171802.png]]
![[Pasted image 20220505172104.png]]
4. 程序的局部性原理：程序执行时所访问的存储器地址分布不是随机的，而是相对地簇聚。
	- 常用的一个经验规则：程序执行时间的90%都是在执行程序中10%的代码
	- 程序的时间局部性：将要用的信息很可能就是目前正在使用的信息
	- 程序的空间局部性：将要用到的信息很可能与目前正在使用的信息的未知相邻或者临近

## 计算机系统的性能评测
1. 执行时间（用户角度， 单个程序的执行时间）
	- 计算机完成某一任务所花费的全部时间
	- CPU时间：CPU执行给定的程序所花费的时间，不包含I/O等待时间以及运行其他程序的时间
2. 吞吐率（管理员角度：单位时间里能完成的任务）
3. 基准测试程序：最佳选择是真实的应用程序
	- 目前最成功和最常见的测试程序套件是SPEC系列
	- 台式计算机的基准测试程序套件分为两大类：处理器性能测试程序和图型性能测试程序
4. 性能比较
	![[Pasted image 20220505174430.png]]
	- 总执行时间
	- 加权平均值
		![[Pasted image 20220505174752.png]]

# 计算机系统结构的发展
## 冯·诺依曼结构
![[Pasted image 20220505175004.png]]
- 以ALU为中心（spot，热点）
- 存储程序原理的基本点：指令驱动
- 主要特点：
	- 整个机器以运算器为中心
	- 采用存储程序原理，程序指令和数据放在同一存储器中
	- 存储器是按地址访问、按顺序线性编址的一维结构，每个单元的位数是固定的
	- 指令的执行是顺序的
		- 一般是按照指令在存储器中存放的顺序执行
		- 程序的分支由转移指令实现
		- 由指令计数器PC指明当前正在执行的指令在存储器中的地址
	- 指令由操作码和地址码组成
	- 指令和数据均以二进制编码表示，采用二进制运算


## 对系统结构进行的改进
- 输入输出方式的改进
![[Pasted image 20220506141946.png]]
- 采用并行处理技术
	- 如何挖掘传统机器中的并行性？
	- 在不同的级别采用并行技术
		- 微操作级
		- 指令级
		- 线程级
		- 进程级
		- 任务级
- 存储器组织结构的发展
	- 相联存储器与相联处理机
	- 通用存储器组
	- 高速缓冲存储器Cache
- 指令集的发展
	- 两个发展方向
		- RISC（精简指令集计算机）
		- CISC（复杂指令集计算机）


## 软件对系统结构的影响
- 解决兼容性问题：使得软件不加修改地就能从一台机器在另一台机器上运行
	- 系列机
	- 模拟与仿真
	- 高级语言
- 系列机
	- ![[Pasted image 20220506143021.png]]
	- 向后兼容是系列机的根本特征
- 模拟与仿真
	- 使软件能在具有不同系统结构的机器之间相互移植
		- 在一种系统结构上实现另一种系统结构
		- 从指令集的角度来看，就要在一种机器上实现另一种机器的指令集
	- 模拟：用软件的方法在一台现有的机器（称为**宿主机**）上实现另一台机器（称为**虚拟机**）的指令集。
		- 通常用解释的方法来实现
		- 运行速度较慢，性能较差
	- 仿真：仿真是指用一台现有机器（**宿主机**）上的微程序去解释实现另一台机器的指令集（**目标机**）
		- 运行速度比模拟快
		- ![[Pasted image 20220506143621.png]]
- 统一高级语言
	- 实现软件移植的一种理想的方法
	- 较难实现

## 器件发展对系统结构的影响
1. 摩尔定律
2. 计算机的分代主要以器件作为划分标准：![[Pasted image 20220506144024.png]]


## 应用对系统结构的影响
1. 不同的应用对计算机系统结构的设计提出了不同的要求
2. 应用需求是促使计算机系统结构发展的**最根本的动力**
3. 一些特殊领域：需要高性能的系统结构
4. 计算机性能随时间下移

## 系统结构的生命周期
1. 系统结构的**生命周期**：从诞生、发展、成熟到消亡
2. 周期的每个阶段都在5·7年
3. ![[Pasted image 20220506145009.png]]



# 计算机系统结构中并行性的发展
## 并行性的概念
1. 并行性：计算机系统在统一时刻或者同一时间间隔内进行多种运算或操作
![[Pasted image 20220506145324.png]]
2. 从处理数据的角度来看，并行性等级从低到高可分为
![[Pasted image 20220506145512.png]]
3. 从执行程序的角度来看，并行性等级从低到高可分为
![[Pasted image 20220506145854.png]]

## 提高并行性的技术途径
### 时间重叠
多个处理过程在时间上相互错开，轮流重叠地使用同一套硬件设备的各个部分，以加快硬件周转而赢得速度
### 资源重复
重复设置资源，尤其是硬件资源，大幅度提高计算机系统的性能
### 资源共享
这是一种软件方法，它使多个任务按一定时间顺序轮流使用同一套硬件设备

## 单机系统中并行性的发展
1. 在发展高i性能单处理器过程中，起主导作用的是**时间重叠原理**
	实现时间重叠的基础：部件功能专用化
	- 把一件工作按功能分割为若干相互联系的部分
	- 把每一部分指定给专门的部件完成
	- 按时间重叠原理把各部分的执行过程在时间上重叠起来，使所有部件一次分工完成一组同样的工作
![[Pasted image 20220506151000.png]]
2. 在单处理机中，资源重复原理的运用也已经十分普遍
	多体存储器
	多操作部件：指令级并行
	阵列处理机（并行处理机）
3. 单处理机中，资源共享的概念实质上是用单处理机模拟多处理机的功能，形成所谓虚拟机的概念
	- 分时系统


## 多机系统中并行性的发展
1. 多机系统遵循时间重叠、资源重复、资源共享原理，发展为3种不同的多处理机：
	1. 异构型多处理机
	2. 同构型多处理机
	3. 分布式系统
2. 耦合度
	反映多机系统中各机器之间物理连接的紧密程度和交互作用能力的强弱。
	- 紧密耦合系统（直接耦合系统）：在这种系统中，计算机之间的物理连接的频带较高，一般是通过总线或高速开关互连，可以共享主存。（可以以单个数据为单位）
	- 松散耦合系统（间接耦合系统）：一般是通过通道或通信线路实现计算机之间的互连，可以共享外存设备（磁盘、磁带）。机器之间的相互作用是在文件或数据集一级上进行的。
		- ![[Pasted image 20220506152607.png]]
3. 功能专用化（实现时间重叠）
	- 专用外围处理机（如：输入/输出功能的分离）
	- 专用处理机：数组运算、高级语言翻译、数据库管理等
	- 异构型多处理机系统
		- ![[Pasted image 20220506152910.png]]
4. 机间互连
	- 容错系统
	- 可重构系统
	- 同构型多处理机系统
		- 由多个同类型或至少担负同等功能的处理机组成，它们同时处理同一作业中能并行执行的多个任务。