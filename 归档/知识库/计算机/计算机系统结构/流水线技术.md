# 重叠执行和线性控制

# 流水线的基本概念
## 流水线技术
- 把一个重复的过程分解为若干个子过程，每个子过程由专门的部件来实现
- 把多个处理过程在时间上错开，依次通过各功能段，每个子过程就可以与其他的子过程并行进行
- 流水线的每个子过程及其功能部件称为流水线的级或段，段与段相互连接形成流水线。流水线的段数称为流水线的**深度**。
- **指令流水线**：
![[Pasted image 20220510142813.png]]
- 浮点加法流水线
![[Pasted image 20220510142934.png]]

- **时空图**
![[Pasted image 20220510143050.png]]

- 流水技术的特点
![[Pasted image 20220510143411.png]]
![[Pasted image 20220510143756.png]]


## 流水线的分类
1. 单功能流水线与多功能流水线
	1. 单功能流水线：只能完成一种固定功能的流水线
	2. 多功能流水线：流水线的各段可以进行不同的连接，以实现不同的功能

2. 静态流水线与动态流水线
![[Pasted image 20220510144606.png]]
![[Pasted image 20220510144712.png]]
![[Pasted image 20220510144934.png]]

3. 部件级、处理机级及处理机间流水
![[Pasted image 20220510145155.png]]
![[Pasted image 20220510145227.png]]

4. 线性流水线与非线性流水线
![[Pasted image 20220510145427.png]]

5. 顺序流水线与乱序流水线
![[Pasted image 20220510153046.png]]

6. 标量处理机与向量流水处理机
![[Pasted image 20220510153337.png]]

 

# 流水线的性能指标
## 吞吐率
![[Pasted image 20220510153813.png]]

### 各段时间均相等的流水线
![[Pasted image 20220510154042.png]]
![[Pasted image 20220510154139.png]]
![[Pasted image 20220510154353.png]]

### 各段时间不完全相等的流水线
**瓶颈段**：流水线中这种时间最长的段。
![[Pasted image 20220510154634.png]]
![[Pasted image 20220510154827.png]]
- **流水线完成连续n个任务（子任务间完成时间不相等）所需要的时间：**
$$
T_k = \sum^k_{i=1}\Delta t_i+(n-1)max(\Delta t_1,\Delta t_2, ···,\delta t_k)=通过时间+(n-1)倍子任务最长执行时间
$$


### 解决流水线瓶颈问题的常用方法
![[Pasted image 20220510155729.png]]
![[Pasted image 20220510160059.png]]
![[Pasted image 20220510160216.png]]
![[Pasted image 20220510161309.png]]

## 加速比
![[Pasted image 20220510161454.png]]


### 流水线完成各段时间相等
![[Pasted image 20220510161536.png]]
![[Pasted image 20220510161633.png]]

### 流水线的各段时间不完全相等

![[Pasted image 20220510162032.png]]

## 效率
![[Pasted image 20220510162119.png]]
![[Pasted image 20220510162737.png]]

![[Pasted image 20220511080439.png]]

![[Pasted image 20220511080621.png]]


## 举例
![[Pasted image 20220511081334.png]]
![[Pasted image 20220511082112.png]]
两组相同的运算对于乱序流水线效率更高
![[Pasted image 20220511082332.png]]

![[Pasted image 20220511083538.png]]

## 流水线设计中的若干问题
  1. 瓶颈问题
  2. 流水线的额外开销
	  1. 流水寄存器延迟
	  2. 时钟偏移开销 
![[Pasted image 20220511085449.png]]
所以流水线不能过度细分，否则会带来过高比例的额外开销、

# 流水线的相关与冲突
## 相关
![[Pasted image 20220511090325.png]]
### 数据相关
![[Pasted image 20220511090704.png]]

### 名相关
![[Pasted image 20220511090921.png]]

![[Pasted image 20220511090936.png]]
  ![[Pasted image 20220511091214.png]]

### 控制相关
![[Pasted image 20220511091330.png]]

![[Pasted image 20220511091423.png]]

## 冲突
![[Pasted image 20220511092537.png]]
![[Pasted image 20220511092640.png]]

![[Pasted image 20220511093111.png]]

（折中！成本与效率）

 ![[Pasted image 20220511093744.png]]
![[Pasted image 20220511100027.png]]
![[Pasted image 20220511101517.png]]
![[Pasted image 20220511102043.png]]

![[Pasted image 20220511102945.png]]

**预测分支**
![[Pasted image 20220511103429.png]]

![[Pasted image 20220511103555.png]]

**延时分支**
![[Pasted image 20220511103736.png]]
![[Pasted image 20220511104052.png]]

 ![[Pasted image 20220511104115.png]]

  
# 流水线的实现