# 指令集结构的分类
1. 区别不同指令集结构的主要因素
	CPU用来存储操作数的存储单元的类型
2. CPU中用存储操作数的存储单元的主要类型
	- 堆栈
	- 累加器
	- 通用寄存器组
3. 将指令集结构分为三种类型
	1. 堆栈结构
	2. 累加器结构
	3. 通用寄存器结构
		操作数的来源：
		1. 寄存器-存储器结构（RM结构）
		2. 寄存器-寄存器结构（RR结构）
			也称为load-store结构
4. 对于不同类型的指令集结构，操作数的位置、个数以及操作数的给出方式（显示或隐式）也会不同
	1. 显示给出：用指令字中的操作字段给出
	2. 隐式给出：使用事先约定好的存储单元
5. 四种类型
![[Pasted image 20220510084851.png]]
 
6. 通用寄存器结构
	- 现代指令集结构的主流
	- 在灵活性和提高性能方面有明显的优势
		- 访问速度快
		- 便于编译器编译
		- 更少的地址位寻址，减少程序的目标代码的大小
7. 根据ALU的两个特征细分通用寄存器型指令
	1. ALU指令中存储器的操作数（0~3）
	2. ALU指令中操作数的最多个数（2，3）
8. 通用寄存器指令集结构进一步细分为三种类型:
	1. RR(0,3)
	2. RM(1,2)
	3. MM(2,2)/(3,3)


# 寻址方式
1.  一种指令集结构如何确定所要访问的数据的地址？
2. 当前的指令集结构中采用的一些操作数寻址方式
	1. <--：赋值操作
	2. Mem：存储器
	3. Regs：寄存器组
	4. 方括号：表示内容
		1. Mem[]:存储器的内容
		2. Regs[]:寄存器的内容
		3. Mem[Regs[R1]]:以寄存器R1中的内容作为地址的存储器单元中的内容
![[Pasted image 20220510090759.png]]

- 采用多种寻址方式可以显著地减少程序的指令条数，但可能增加计算机的实现复杂度以及指令的CPI 
![[Pasted image 20220510091203.png]]

4. 偏移量的取值范围
![[Pasted image 20220510091415.png]]
	- 程序所使用的偏移量大小分布非常广泛
	- 较小的偏移量和较大的偏移量均占有较大的比例
5. 立即数寻址方式
![[Pasted image 20220510091617.png]]
	- 最常用的是较小的立即数
	- 有时也会用到较大的立即数
	- 在指令集结构设计中至少要将立即数设置为8~16位

# 指令集结构的功能设计
1. 指令集结构的功能设计
	确定软硬件功能分配 
2. 主要考虑三个因素：速度、成本、灵活性
	1. 硬件实现的特点：速度快、成本高、灵活性差
	2. 软件实现的特点：速度慢、成本低、灵活性好
3. 对指令集的基本要求
	完整性、规整性、高效率、兼容性
	- 完整性：在一个有限可用的存储空间内，对于任何可解阿问题，编制计算程序时，指令集所提供的指令足够用
		- 前4类属于通用计算机系统的基本指令
		- 最后4种类型的操作，不同指令集结构的支持大不相同
		- ![[Pasted image 20220510092327.png]]
	- 规整性：主要包括对称性和均匀性。
	![[Pasted image 20220510092717.png]]
	- 高效率
4. 两种截然不同的设计策略
	1. CISC（复杂指令集计算机）
	2. RISC（精简指令集计算机）
## CISC指令集结构的功能设计
1. CISC结构追求的目标
	强化指令功能，减少程序的指令条数，以达到提高性能的目的
2. 增强指令功能主要是从以下几个方面着手：
	1. 面向目标程序增强指令功能
		1. 增强运算型
		2. 增强数据传送
		3. 增强程序控制
	- ![[Pasted image 20220510093315.png]]
	2. 面向高级语言的优化实现来改进指令集
		- 缩小高级语言与机器语言的语义差距
		- ![[Pasted image 20220510093600.png]]
		-  ![[Pasted image 20220510093717.png]]
		- 增强对高级语言和编译器的支持
		- 高级语言机器
			- 间接执行高级语言机器
			- 直接执行高级语言机器
		- 面向操作系统的优化实现改进指令集
			- ![[Pasted image 20220510094036.png]]

## RISC指令集结构的功能设计
1. CISC指令集结构存在的问题
	- 各种指令的使用频度相差悬殊
	- ![[Pasted image 20220510094510.png]]
	- 指令集庞大，指令条数很多，许多指令的功能又很复杂，使得控制器硬件非常复杂。
	- CPI较大
	- 不利于采用流水技术提高性能
2. 设计RISC机器遵循的原则
	- 指令条数少而简单
	- 采用简单而又统一的指令格式，减少寻址方式
	- 指令的执行在单个机器周期内完成（采用流水线机制）
	- 只有load和store指令才能访问存储器，其他指令的操作都是在寄存器之间进行。（RR结构）
		- 大多数指令都采用硬连逻辑来实现
3. 早期的RISC微处理器
	1. 1981年，Berkeley分校的Patterson等人的32位微处理器RISC I
	2. 1983年的RISCII
	3. 1981年，Stanford大学Hennessy研制微处理器MIPS
		- 后来发展成了MIPS Rxxx系列微处理器
	4. IBM的801

## 控制指令
1. 控制指令是用来改变控制流的
	1. 跳转：无条件改变控制流
	2. 分支：有条件改变控制流
2. 能够改变控制流的指令
	1. 分支
	2. 跳转
	3. 过程调用
	4. 过程返回
3. ![[Pasted image 20220510095426.png]]
4.![[Pasted image 20220510095507.png]]

 5. 转移目标地址的表示
 在指令中提供一个偏移量

6. 过程调用和返回
保存机器状态

# 操作数的类型和大小
 - 数据表示：计算机硬件能够直接识别、指令集可以直接调用的数据类型
 - 数据结构：由软件进行处理和实现的各种数据类型。

1. 表示操作数类型的方法
	1. 由指令中的操作码指定操作数的类型
	2. 带标志符的数据表示。给数据加上标识，由数据本身给出操作数类型
		1. 优点：简化指令集，可由硬件自动实现一致性检查和类型转换
		2. 缺点：动态开销比较大
2. 操作数的大小：操作数的位数或字节数
3. 访问不同操作数大小的频度
	![[Pasted image 20220510110447.png]]

# 指令格式的设计
1. 指令由两部分组成：操作码、地址码
2. 指令格式的设计
	确定指令字的编码方式，包括操作码字段和地址码字段的编码和表示方式
3. 操作码的编码比较简单和直观
	1. Huffman编码法：减少操作码的平均位数，但所获得的编码是变长的，不规整，不利于硬件处理。
	2. 固定长度的操作码：保证操作码的译码速度。
4. 两种表示寻址方式的方法
	1. 将寻址方式编码于操作码中，由操作码描述相应操作的寻址方式
	2. 设置专门的地址描述符，由地址描述符表示相应操作数的寻址方式
5. 考虑因素
	1. 机器中寄存器的个数和寻址方式的数目对指令平均字长的影响以及它们对目标代码大小的影响
	2. 所设计的指令格式便于硬件处理，特别是流水实现
	3. 指令字长应该是字节（8位）的整数倍，而不能是随意的位数
6. 指令集的3中编码格式
	1. 变长编码格式
		- 当指令集的寻址方式和操作数种类很多时，该种编码方式较好
	2. 定长编码格式
		- 将操作类型和寻址方式一起编码到操作码中
		- 大部分RISC采用该种编码格式
	3. 混合型编码格式
		- 提供若干种固定的指令字长

# MIPS指令集结构
介绍MIPS64的一个子集，简称为MIPS
## MIPS的寄存器
1. 32个64位通用寄存器（GPRs)
	1. R0~R31
	2. 也被称为整数寄存器
	3. R0的值永远是0
2. 32个64位浮点数寄存器（FPRs)
	1. F0~F31
	2. 用来存放32个单精度浮点数（32位）或32个双精度浮点型（64位）
	3. 存储单精度浮点数（32位）时，只用到FPR的一半，其另一半没用
3. 一些特殊寄存器
	它们可以用于与通用寄存器交换数据

## MIPS的数据表示
1. MIPS的数据表示
	1. 整数
		1. 字节 8位
		2. 半字 16位
		3. 字 32位
		4. 双字 64位
	2. 浮点数
		1. 单精度浮点数 32位
		2. 双精度浮点数 64位
2. 字节、半字或者字在装入64位寄存器时，用零扩展或者用符号位扩展来填充该寄存器的剩余部分。装入以后，对它们将按照64位整数的方式进行运算 

## MIPS的数据寻址方式
1. 立即数寻址与偏移量寻址
	1. 立即数字段和偏移量字段都是16位的
2. 寄存器间接寻址是通过把0作为偏移量来实现的
3. 16位绝对寻址是通过把R0作为机制寄存器来完成的、
4. MIPS的存储器是按字节寻址的，地址为64位
5. 所有存储器访问都必须是边界对齐的 

## MIPS的指令格式
1. 寻址方式编码到操作码中
2. 所有的指令都是32位的
3. 操作码占6位
4. 3种指令格式
![[Pasted image 20220510113219.png]]
![[Pasted image 20220510113309.png]]

![[Pasted image 20220510135835.png]]
![[Pasted image 20220510135846.png]]

## MIPS操作
1.  MIPS指令可以分为四大类
	1. load和store
	2. ALU操作
	3. 分支与跳转
	4. 浮点操作
2. 符号的意义
	1. $x\leftarrow y_n$：从y传送n位到x
	2. $x,y \leftarrow z$：把z传送到x和y 
	- ![[Pasted image 20220510140253.png]]
	- ![[Pasted image 20220510140511.png]]
3. load和store指令
![[Pasted image 20220510140650.png]]
4. ALU指令
![[Pasted image 20220510140734.png]]

## MIPS控制指令
1. 由一组跳转和一组分支指令来实现控制流的改变
2. 典型的MIPS控制指令

![[Pasted image 20220510140929.png]]
3. 跳转指令
![[Pasted image 20220510141053.png]]

4. 分支指令
![[Pasted image 20220510141200.png]]

## MIPS的浮点操作
1. 由操作码指出操作数是单精度（SP）或双精度（DP）
	1. 后缀S：表示操作数是单精度浮点数
	2. 后缀D：表示是双精度浮点数
2. 浮点操作：包括加、减、乘、除，分别有单精度和双精度指令
3. 浮点数比较指令
![[Pasted image 20220510141514.png]]